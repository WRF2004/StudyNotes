# 第五章 设备管理

总线(Bus)：接入I/O设备的主要方式

### I/O设备的分类

* 按数据组织分类：
  * 块设备：以数据块为单位存储、传输信息。传输速 率较高、可寻址（随机读写） 
  * 字符设备：以字符为单位存储、传输信息。传输速 率低、不可寻址。

* 按用途分类：
  * 存储设备：磁盘、磁带；
  * 传输设备：网卡，Modem；
  * 人机交互设备：显示器、键盘、鼠标。
* 按共享属性分：
  * 独占
  * 共享
  * 虚拟

### I/O接口(设备控制器)

![微信截图_20240523160152](D:%5CDesktop%5C%E7%85%A7%E7%89%87%5CPictures%5C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%5C%E7%AC%AC%E4%BA%94%E7%AB%A0%5C%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240523160152.png)

* 控制器的功能
  * 接收和识别CPU命令 
  * 数据交换：CPU与控制器、控制器与设备 
  * 设备状态的了解和报告 
  * 设备地址识别 
  * 缓冲区 
  * 对设备传来的数据进行差错检测

* 组成
  * 控制器与CPU接口：数据寄存器、控制寄存器、状 态寄存器，采用内存映射或专门的I/O指令  
  * 控制器与设备接口：数据信号、控制信号、状态信号 
  * I/O逻辑：用于实现CPU对I/O设备的控制

#### I/O端口

设备控制器中可被CPU直接访问的寄存器。

* 数据寄存器
* 状态寄存器
* 控制寄存器
* 端口地址
  * 内存映射I/O
    * 控制器的内存/寄存器作为物理内存空间的一部分
    * 优点：
      * 不需要特殊的保护机制来阻止用户进程进行相应的 I/O 操作。操作系统要避免把包含了控制寄存器的 那部分地址空间放入用户的虚拟地址空间中。 
      * 可以引用内存的每一条指令都可以适用于引用控制 寄存器。
    * 缺点：
      * 不允许对一个控制寄存器的内容进行高速缓存。
      * 使主存容量变小
      * 使译码电路变复杂，降低寻址速度
  * I/O独立编址
    * 端口地址与主存空间是两个独立的地址空间
    * 优点：
      * 外设不占用内存的地址空间 
      * 编程时，易于区分是对内存操作还是对I/O 操作
      * 寻址速度快
    * 缺点：
      * I/O端口操作的指令类型少，操作不灵活

### I/O控制方式

控制设备与主机之间的数据传送p[]

* 程序控制I/O，也称轮询或查询方式I/O，它由CPU代表 进程向I/O模块发出指令，然后进入忙等状态，直到操 作完成之后进程才能够继续执行。  
* 中断驱动，当I/O操作结束后由设备控制器主动地来通知 设备驱动程序，而不是依靠设备驱动程序不断地去轮询 看看设备的状态。  
* DMA，直接存储器访问方式，是由一个专门的控制器来 完成数据从内存到设备或者是从设备到内存的传输工作 。
* 通道与DMA的原理几乎是一样的，通道是一个特殊功能 的处理器，它有自己的指令和程序专门负责数据输入输出 的传输控制。CPU将“传输控制”的功能下放给通道后只 负责“数据处理”功能。这样，通道与CPU分时使用内存 ，实现了CPU内部运算与I/O设备的并行工作。

